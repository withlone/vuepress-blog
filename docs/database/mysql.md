---
sidebar: auto
---

# MySQL

[[TOC]]

## 存储引擎

### InnoDB

- 默认的事务存储引擎
- 事务默认隔离级别为可重复度
- 主索引为聚簇索引(唯一): 索引与数据保存在一起
- 支持在线热备份

### MyISAM

- 空间数据索引
- 不支持事务
- 不支持行级锁, 只能对整张表加锁(写操作排它锁), 允许读取时插入(并发插入)

## 索引

### B+Tree

**VS B-Tree**:

- 非叶子结点只存储键值信息, 叶子结点存储数据
- 叶子结点有指针指向下一个叶子结点

**VS 红黑树**:

- 树的高度更低, 查找次数更少
- 磁盘有预读, 磁盘顺序读取时无需磁盘寻道, 速度快, 结点大小为页大小, 一次IO载入一个结点且能预读相邻结点

#### 聚簇索引

- InnoDB
- 数据行只存储在索引的叶子结点中, 非叶子结点不存储
- 默认是主键, 若无主键InnoDB选择一个非空索引代替, 若再无则隐式定义主键作为聚簇索引
- 辅助索引先通过辅助索引对应的B+Tree找到叶子节点上的主键信息, 然后再通过主键索引对应的B+Tree找到数据信息

#### 非聚簇索引

- MyISAM
- 叶子结点上不存储数据, 存储数据的地址

### 哈希索引

- InnoDB中为自适应哈希索引, 被频繁使用的索引会在B+Tree索引上创建哈希索引

### 全文索引

- MyISAM和5.6后的InnoDB支持
- 使用MATCH AGAINST语法
- 比`like`高效, 但是存在精度问题
- 只能对`char, text`等类型建全文索引
- `自然语言全文索引`: 出现频率超过50%则不会被搜索, 匹配出现频率更少的
- `布尔全文索引`: 通过修饰符进行更加细致的匹配方式

### 空间数据索引

- 用于地理数据存储

### 索引优化

- 表达式的一部分或者函数的参数的索引没有作用
- 搜索有多个条件时使用`多列索引`, 让选择性更强的索引放在前面, 选择性为不重复索引占比
- 对于`BLOB, TEXT, VARCHAR`等大数据使用`前缀索引`
- 索引包含需查询字段为`覆盖索引`, 可以防止`回表`(通过索引找到聚簇索引后在拿到数据)
