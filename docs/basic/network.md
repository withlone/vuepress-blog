# 计算机网络

[[TOC]]

## OSI7

> 物理层 &rarr; 数据链路层 &rarr; 网络层 &rarr;
传输层 &rarr; 会话层 &rarr; 表示层 &rarr; 应用层

`物理层`: 提供物理连接, 透明的比特流传输

`数据链路层`: 通过控制协议, 将物理信道转为可靠的数据链路

- MAC介质访问控制层: 解决共享网络中多用户对信道竞争的问题
- LLC逻辑链路控制层: 建立维护网络连接, 差错校验

`网络层`: 通过路由选择算法, 完成寻址, 交换, 路由, 网络层协议ip

`传输层`: 差错和流量控制, 保证数据传输的可靠性，传输层协议TCP, UDP

`会话层`: 协调两会话进程通信, 管理数据交互

`表示层`: 处理数据格式, 数据编码, 压缩解压缩, 数据加密解密

`应用层`: 向用户提供网络服务接口, 应用层协议FTP, HTTP

**TCP/IP分层**: 网络接口层, 网间层, 传输层, 应用层

## 集线器, 交换机, 路由器

`集线器`: 物理层, 数据广播到所有端口, 总线拓扑, 共用带宽

`交换机`: 数据链路层, 根据MAC地址转发, 独享带宽, 同一网段通信

`路由器`: 网络层, 根据ip地址转发, 防火墙, 不同网段通信

## 电路交换, 报文交换, 分组交换

`电路交换`: 建立通信独占信道, 独占带宽

`报文交换`: 以报文为数据单位交换, 存储转发, 报文长度差异导致时延大

`分组交换`: 将数据分组传输, 存储转发

## RPC

> RPC: Remote Procedure Call, 远程过程调用

- 采用客户端/服务端模式
- RPC协议: 客户端调用接口, 传入参数, 通过client sub将参数序列化为消息发送给服务端, 服务端接受消息通过server sub反序列化为参数, 调用服务端过程, 最后相同步骤返回给客户端
- RPC框架: Dubbo, SpringCloud
- 通信协议: 可使用HTTP或TCP
- 序列化技术: Jackson, JSON, Hessian

## HTTP

### 报文结构

#### 请求报文

- `请求行`: 请求方法, URL, 协议版本
- `请求头部`: (一行一对)头部字段名-值
- `空行`
- `请求包体`: 用于POST

#### 响应报文

- `状态行`: 协议版本, 状态码, 状态码描述
- `响应头部`: (一行一对)头部字段名-值
- `空行`
- `响应包体`: 响应内容

### 通信数据转发

- 代理: 接受客户端请求, 转发给其他服务器
  - 正向代理: 通过代理服务器访问原始服务器资源(例如无法直接访问的服务器), 客户端知道代理服务器
  - 反向代理: 代理服务器接受网络请求, 转发给内部服务器, 客户端不知道是代理服务前正在代理
- 网关: 将HTTP转化为其他协议通信
- 隧道: 使用SSL等加密手段, 建立安全通信线路

## HTTPS

### 加密

1. 客户端向服务端获取服务端公钥
2. 客户端生成一个对称密钥, 通过公钥加密后发给服务端
3. 服务端使用公钥对应的私钥解密出对称密钥
4. 之后的通信使用密钥进行加密

### 认证

通过使用证书对通信方进行认证

1. 服务器向CA(数字证书认证机构, 可信赖的第三方)申请公钥
2. CA对申请的公钥做数字签名, 将公钥放入公钥证书绑定
3. HTTPS通信时, 服务器发送证书给客户端, 客户端获得其中的公钥以及数字签名, 验证数字签名后通信

### 完整性保护

SSL提供MD5报文摘要进行完整性保护

## HTTP/1.0 VS HTTP/1.1

HTTP/1.1默认长连接, 支持同时多个TCP连接, 新增状态码100, 支持分块传输编码, 新增缓存处理命令

## HTTP/2.0

- `二进制分帧层`: 将报文分为HEADERS帧和DATA帧, 帧可交错发送, 消息是一系列帧的组装
- `服务端推送`: 客户端请求一个资源时, 同时返回相关资源
- `首部压缩`: 要求客户端和服务端同时维护和更新首部字段表并进行Huffman编码压缩, 避免重复传输